<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Snake & Ladder</title>
<link href="https://fonts.googleapis.com/css2?family=Prompt&display=swap" rel="stylesheet">

<style>
body{
  margin:0;
  font-family:Arial, sans-serif;
  background:#fdf6aa;
}

#leaderboard{
  position:fixed;
  top:15px;
  right:15px;
  background:white;
  padding:12px;
  border-radius:10px;
  box-shadow:0 4px 10px rgba(0,0,0,0.2);
  font-size:14px;
  min-width:160px;
  max-height:60vh;     /* üî• ‡∏à‡∏≥‡∏Å‡∏±‡∏î‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏π‡∏á */
  overflow-y:auto;     /* üî• ‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡∏†‡∏≤‡∏¢‡πÉ‡∏ô‡πÑ‡∏î‡πâ */
}


#leaderboard h3{
  margin:0 0 8px 0;
  font-size:16px;
}

#leaderboard div{
  margin-bottom:4px;
}


#gameScreen{
  height:100vh;
  overflow:hidden;
  display:flex;
  flex-direction:column;
  align-items:center;
  justify-content:flex-start;
  padding:10px;
  box-sizing:border-box;
}

#boardWrapper{
  position:relative;
  width:min(90vw, calc(100dvh - 180px));
  height:min(90vw, calc(100dvh - 180px));
  max-width:600px;
  max-height:600px;
}








#board{
  width:100%;
  height:100%;
  display:grid;
  grid-template-columns:repeat(10,1fr);
  grid-template-rows:repeat(10,1fr);
}

#overlay{
  position:absolute;
  top:0;
  left:0;
  width:100%;
  height:100%;
  pointer-events:none;}
.overlayImg{
  position:absolute;
  top:0;
  left:0;
  width:100%;
  height:100%;
  object-fit:cover;   /* ‡πÉ‡∏´‡πâ‡πÄ‡∏ï‡πá‡∏°‡∏û‡∏≠‡∏î‡∏µ‡∏Å‡∏£‡∏∞‡∏î‡∏≤‡∏ô */
  pointer-events:none;
  z-index:1;
  }


.cell{
  border:2px solid black;
  display:flex;
  justify-content:center;
  align-items:center;
  font-weight:bold;
  font-size:2vmin;
  position:relative;
}

.player{
  width:60%;
  height:60%;
  border-radius:50%;
  position:absolute;
  bottom:5%;
}




/* ‡∏Å‡∏•‡πà‡∏≠‡∏á‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏° */
#questionText{
  max-width:600px;
  font-size:20px;
  margin-bottom:20px;
}

/* ‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å */
#choices{
  width:100%;
  max-width:500px;
  display:flex;
  flex-direction:column;
  gap:10px;
}

#choices button{
  padding:12px;
  font-size:16px;
  border:none;
  border-radius:8px;
  background:#2196f3;
  color:white;
  cursor:pointer;
  transition:0.2s;
}

#choices button:hover{
  background:#1976d2;
}

#choices button:active{
  transform:scale(0.97);
}
#questionButtonWrapper{
  margin:15px 0;
  display:flex;
  justify-content:center;
  width:100%;
}

#questionBtn{
  width:90%;
  max-width:400px;
  padding:14px;
  font-size:18px;
  border:none;
  border-radius:12px;
  background:#ff9800;
  color:white;
  cursor:pointer;
  transition:0.2s;
}

#questionBtn:hover{
  background:#f57c00;
}

#questionBtn:active{
  transform:scale(0.96);
}

#questionScreen{
  position:absolute;
  top:0;
  left:0;
  width:100%;
  height:100%;
  background:rgba(0,0,0,0.4);  /* ‡∏°‡∏∑‡∏î‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏Å‡∏£‡∏∞‡∏î‡∏≤‡∏ô */
  display:none;
  justify-content:center;
  align-items:center;
  z-index:50;
}


/* ‡∏Å‡∏•‡πà‡∏≠‡∏á‡∏ï‡∏£‡∏á‡∏Å‡∏•‡∏≤‡∏á */
#questionBox{
  width:80%;
  max-width:400px;
  background:white;
  padding:20px;
  border-radius:14px;
  box-shadow:0 8px 20px rgba(0,0,0,0.3);
  display:flex;
  flex-direction:column;
  gap:12px;
  text-align:center;
  animation:popup 0.25s ease;
}


@keyframes popup{
  from{
    transform:scale(0.8);
    opacity:0;
  }
  to{
    transform:scale(1);
    opacity:1;
  }
}


@media (max-width:768px){

  #leaderboard{
    position:relative;   /* ‡πÄ‡∏≠‡∏≤ fixed ‡∏≠‡∏≠‡∏Å */
    top:auto;
    right:auto;
    width:100%;
    margin:10px 0;
    box-sizing:border-box;
    z-index:auto;
    overflow:auto;
    max-height:20vh;
  }

  

}




</style>
</head>

<body>

<div id="gameScreen">
  <h2>‡πÄ‡∏Å‡∏°‡∏á‡∏π‡∏ö‡∏±‡∏ô‡πÑ‡∏î</h2>
  <div id="leaderboard" ></div>
<div id="questionButtonWrapper">
  <button id="questionBtn" onclick="getQuestion()">QUESTION HERE</button>
</div>

  <div id="boardWrapper">
    <div id="board"></div>
    <div id="overlay"></div>
    <img src="boo.PNG" class="overlayImg">
    <div id="questionScreen">
      <div id="questionBox">
        <div id="questionText"></div>
        <div id="choices"></div>
      </div>
    </div>
</div>


<script src="/socket.io/socket.io.js"></script>
<script>



const socket = io();
let myId = null;

socket.on("connect", ()=>{
  myId = socket.id;
});
let iFinished = false;
let animatingPlayerId = null;
let isAnimating = false;
let questionOpen = false;

const board = document.getElementById("board");
const overlay = document.getElementById("overlay");
const lb = document.getElementById("leaderboard");

const name = localStorage.getItem("playerName");
const room = localStorage.getItem("roomName");
if(!name){ window.location.href="index.html"; }
socket.emit("newPlayer", { name, room });

/* ===== ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Å‡∏£‡∏∞‡∏î‡∏≤‡∏ô ===== */
for (let row = 9; row >= 0; row--) {
  for (let col = 0; col < 10; col++) {

    const cell = document.createElement("div");
    cell.className = "cell";

    let number;
    if (row % 2 === 0) {
      number = row * 10 + col + 1;
    } else {
      number = row * 10 + (9 - col) + 1;
    }

    cell.id = "cell-" + (number);
    cell.innerText = number;
    cell.style.backgroundColor = (row+col)%2===0 ? "#e3f2fd" : "#90caf9";

    board.appendChild(cell);
  }
}

/* ===== ‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏ä‡πà‡∏≠‡∏á ===== */
function getCellPosition(number){
  const row = Math.floor((number - 1) / 10);
  let col = (number - 1) % 10;

  if(row % 2 === 1){
    col = 9 - col;
  }

  const cellSize = board.offsetWidth / 10;

  return {
    x: col * cellSize,
    y: (9 - row) * cellSize
  };
}

/* ===== ‡∏õ‡∏∏‡πà‡∏°‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏° ===== */
function getQuestion(){

  if(iFinished || questionOpen || isAnimating) return;

  questionOpen = true;
  document.getElementById("questionBtn").disabled = true;

  socket.emit("getQuestion");
  }


/* ===== ‡πÅ‡∏™‡∏î‡∏á‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏° ===== */
socket.on("showQuestion",(data)=>{

  if(questionOpen === false) return; // üî• ‡∏Å‡∏±‡∏ô event ‡∏ã‡πâ‡∏≠‡∏ô

  document.getElementById("questionText").innerText = data.question;

  const choicesDiv = document.getElementById("choices");
  choicesDiv.innerHTML = "";

  data.choices.forEach(choice=>{

    const btn = document.createElement("button");
    btn.innerText = choice;
    btn.style.margin = "5px";

    btn.onclick = ()=>{

      if(iFinished) return;

      document.querySelectorAll("#choices button")
        .forEach(b=> b.disabled = true);

      socket.emit("answer", choice);
    };

    choicesDiv.appendChild(btn);
  });

  document.getElementById("questionScreen").style.display="flex";
});



/* ===== ‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô ===== */
socket.on("updatePlayers",(players)=>{

  const lb = document.getElementById("leaderboard");
  lb.innerHTML = "";

  const sortedPlayers = Object.entries(players)
    .sort((a,b)=> b[1].position - a[1].position);

  sortedPlayers.forEach(([id,player],index)=>{

    const rank = index +1;

    lb.innerHTML += `
      <div style="margin-bottom:6px;">
        #${rank} -
        <span style="color:${player.color}; font-weight:bold;">
          ${player.name}
        </span>
        (${player.position})
      </div>
    `;

    let piece = document.getElementById("player-"+id);

    if(!piece){
      piece = document.createElement("div");
      piece.className="player";
      piece.id="player-"+id;
      piece.style.background = player.color;
    }

    // üî• ‡∏ñ‡πâ‡∏≤‡∏ï‡∏±‡∏ß‡∏ô‡∏µ‡πâ‡∏Å‡∏≥‡∏•‡∏±‡∏á animate ‡∏´‡πâ‡∏≤‡∏°‡∏ß‡∏≤‡∏£‡πå‡∏õ
    if(id === animatingPlayerId) return;

    const cell = document.getElementById("cell-"+player.position);
    if(cell) cell.appendChild(piece);

  });

});


/* ===== Animation ===== */
function sleep(ms){ return new Promise(r=>setTimeout(r,ms)); }

async function animateMove(playerId, from, to){
  const step=from<to?1:-1;
  let current=from;

  const piece=document.getElementById("player-"+playerId);
  if(!piece) return;

  while(current!==to){
    current+=step;
    const cell=document.getElementById("cell-"+current);
    if(cell){ cell.appendChild(piece); }
    await sleep(300);
  }
};

socket.on("answerResult", async (data)=>{
  isAnimating = true;

<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Snake & Ladder</title>
<link href="https://fonts.googleapis.com/css2?family=Prompt&display=swap" rel="stylesheet">

<style>
body{
  margin:0;
  font-family:Arial, sans-serif;
  background:#fdf6aa;
}

#leaderboard{
  position:fixed;
  top:15px;
  right:15px;
  background:white;
  padding:12px;
  border-radius:10px;
  box-shadow:0 4px 10px rgba(0,0,0,0.2);
  font-size:14px;
  min-width:160px;
  max-height:60vh;
  overflow-y:auto;
}

#leaderboard div{
  margin-bottom:4px;
}

#gameScreen{
  height:100vh;
  display:flex;
  flex-direction:column;
  align-items:center;
  padding:10px;
  box-sizing:border-box;
}

#boardWrapper{
  position:relative;
  width:min(90vw,600px);
  height:min(90vw,600px);
}

#board{
  width:100%;
  height:100%;
  display:grid;
  grid-template-columns:repeat(10,1fr);
  grid-template-rows:repeat(10,1fr);
}

.cell{
  border:2px solid black;
  display:flex;
  justify-content:center;
  align-items:center;
  font-weight:bold;
  font-size:2vmin;
  position:relative;
}

.player{
  width:60%;
  height:60%;
  border-radius:50%;
  position:absolute;
  bottom:5%;
}

#questionScreen{
  position:absolute;
  top:0;
  left:0;
  width:100%;
  height:100%;
  background:rgba(0,0,0,0.4);
  display:none;
  justify-content:center;
  align-items:center;
  z-index:50;
}

#questionBox{
  width:80%;
  max-width:400px;
  background:white;
  padding:20px;
  border-radius:14px;
  text-align:center;
}

#choices button{
  margin:5px 0;
  padding:10px;
  border:none;
  border-radius:8px;
  background:#2196f3;
  color:white;
  cursor:pointer;
}
</style>
</head>

<body>

<div id="gameScreen">
  <h2>‡πÄ‡∏Å‡∏°‡∏á‡∏π‡∏ö‡∏±‡∏ô‡πÑ‡∏î</h2>
  <div id="leaderboard"></div>

  <button onclick="getQuestion()" id="questionBtn">
    QUESTION HERE
  </button>

  <div id="boardWrapper">
    <div id="board"></div>

    <div id="questionScreen">
      <div id="questionBox">
        <div id="questionText"></div>
        <div id="choices"></div>
      </div>
    </div>
  </div>
</div>

<script src="/socket.io/socket.io.js"></script>
<script>

const socket = io();
let myId = null;
let animatingPlayerId = null;
let isAnimating = false;
let questionOpen = false;

socket.on("connect", ()=>{
  myId = socket.id;
});

const board = document.getElementById("board");
const lb = document.getElementById("leaderboard");

const name = localStorage.getItem("playerName");
const room = localStorage.getItem("roomName");
if(!name){ window.location.href="index.html"; }
socket.emit("newPlayer",{name,room});

/* ===== ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Å‡∏£‡∏∞‡∏î‡∏≤‡∏ô ===== */
for(let row=9;row>=0;row--){
  for(let col=0;col<10;col++){

    const cell=document.createElement("div");
    cell.className="cell";

    let number;
    if(row%2===0){
      number=row*10+col+1;
    }else{
      number=row*10+(9-col)+1;
    }

    cell.id="cell-"+number;
    cell.innerText=number;
    cell.style.background=(row+col)%2===0?"#e3f2fd":"#90caf9";
    board.appendChild(cell);
  }
}

/* ===== ‡∏õ‡∏∏‡πà‡∏°‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏° ===== */
function getQuestion(){
  if(questionOpen||isAnimating) return;
  questionOpen=true;
  document.getElementById("questionBtn").disabled=true;
  socket.emit("getQuestion");
}

/* ===== ‡πÅ‡∏™‡∏î‡∏á‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏° ===== */
socket.on("showQuestion",(data)=>{
  document.getElementById("questionText").innerText=data.question;
  const choicesDiv=document.getElementById("choices");
  choicesDiv.innerHTML="";

  data.choices.forEach(choice=>{
    const btn=document.createElement("button");
    btn.innerText=choice;
    btn.onclick=()=>{
      document.querySelectorAll("#choices button")
        .forEach(b=>b.disabled=true);
      socket.emit("answer",choice);
    };
    choicesDiv.appendChild(btn);
  });

  document.getElementById("questionScreen").style.display="flex";
});

/* ===== updatePlayers ===== */
socket.on("updatePlayers",(players)=>{

  lb.innerHTML="";

  const sorted=Object.entries(players)
    .sort((a,b)=>b[1].position-a[1].position);

  sorted.forEach(([id,player],index)=>{

    lb.innerHTML+=`
      <div>
        #${index+1} -
        <span style="color:${player.color};font-weight:bold;">
          ${player.name}
        </span>
        (${player.position})
      </div>
    `;

    let piece=document.getElementById("player-"+id);
    if(!piece){
      piece=document.createElement("div");
      piece.className="player";
      piece.id="player-"+id;
      piece.style.background=player.color;
    }

    if(id===animatingPlayerId) return;

    const cell=document.getElementById("cell-"+player.position);
    if(cell) cell.appendChild(piece);
  });
});

/* ===== animation ===== */
function sleep(ms){return new Promise(r=>setTimeout(r,ms));}

async function animateMove(playerId,from,to){
  const piece=document.getElementById("player-"+playerId);
  if(!piece) return;

  const step=from<to?1:-1;
  let current=from;

  while(current!==to){
    current+=step;
    const cell=document.getElementById("cell-"+current);
    if(cell) cell.appendChild(piece);
    await sleep(300);
  }
}

/* ===== answerResult ===== */
socket.on("answerResult",async(data)=>{

  animatingPlayerId=data.playerId;
  isAnimating=true;

  const isMe=data.playerId===myId;

  if(isMe){
    const box=document.getElementById("questionBox");
    box.innerHTML=`
      <div style="font-weight:bold;font-size:20px;">
        ${data.correct?"‡∏ï‡∏≠‡∏ö‡∏ñ‡∏π‡∏Å üéâ":"‡∏ï‡∏≠‡∏ö‡∏ú‡∏¥‡∏î üò¢"}
      </div>
      <div>üé≤ ${data.dice}</div>
    `;
    await sleep(1200);
    document.getElementById("questionScreen").style.display="none";
  }

  let piece=document.getElementById("player-"+data.playerId);
  if(!piece){
    piece=document.createElement("div");
    piece.className="player";
    piece.id="player-"+data.playerId;
    document.getElementById("cell-"+data.start)?.appendChild(piece);
  }

  await animateMove(data.playerId,data.start,data.afterDice);

  const finalCell=document.getElementById("cell-"+data.finalPosition);
  if(finalCell) finalCell.appendChild(piece);

  animatingPlayerId=null;
  isAnimating=false;

  if(isMe){
    questionOpen=false;
    document.getElementById("questionBtn").disabled=false;
  }
});

</script>
</body>
</html>
